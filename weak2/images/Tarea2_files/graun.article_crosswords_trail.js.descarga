(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{289:function(e,t,n){var s=n(95);e.exports=function(e){return e?(e=s(e))===1/0||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0}},386:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return a})),n.d(t,"e",(function(){return c})),n.d(t,"b",(function(){return m})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return l})),n.d(t,"a",(function(){return d}));var s=n(25),o=n(0),i=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(o.a.get("switches.enableDiscussionSwitch"))return Object(s.a)({url:o.a.get("page.discussionApiUrl")+e,type:"get"===t?"jsonp":"json",method:t,crossOrigin:!0,data:n,headers:{"D2-X-UID":o.a.get("page.discussionD2Uid"),"GU-Client":o.a.get("page.discussionApiClientHeader")},withCredentials:!0});throw new Error("Discussion features have been disabled")},r=function(e,t){var n="/discussion/".concat(e,"/comment").concat(t.replyTo?"/".concat(t.replyTo.commentId,"/reply"):"");return i(n,"post",t)},a=function(e){return i("/comment/preview","post",e)},c=function(e){return i("/comment/".concat(e,"/recommend"),"post")},m=function(e){return i("/comment/".concat(e,"/highlight"),"post")},u=function(e){return i("/comment/".concat(e,"/unhighlight"),"post")},l=function(e,t){return i("/comment/".concat(e,"/reportAbuse"),"post",t)},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"me";return i("/profile/".concat(e),"get")}},389:function(e,t,n){"use strict";n.d(t,"a",(function(){return h}));var s=n(5),o=n.n(s),i=n(40),r=n.n(i),a=n(11),c=n(8),m=[],u={top:0,bottom:0},l=function e(){u.top=window.pageYOffset,u.bottom=u.top+o.a.viewport().height,0===(m=m.filter((function(e){return!e.conditionFn()||(e.loadFn(),!1)}))).length&&c.a.off("window:throttledScroll",e)},d=r()(l,2e3),h=function(e,t,n){a.a.measure((function(){var s=o()(e);!function(e,t){var n={conditionFn:e,loadFn:t};m.push(n),1===m.length&&c.a.on("window:throttledScroll",l),d()}((function(){var e=s.offset(),n=e.top-t,o=e.top+e.height+t;return u.top>n&&u.bottom<o}),n)}))}},398:function(e,t,n){"use strict";var s=n(25),o=n(0),i="".concat(o.a.get("page.avatarApiUrl"),"/v1"),r="".concat(o.a.get("page.avatarImagesUrl"),"/user"),a=function(e,t,n){var o={url:i+t,type:"json",data:n,processData:!1,method:e,crossOrigin:!0,withCredentials:!0};return Object(s.a)(o)};t.a={request:a,getActive:function(){return a("GET","/avatars/user/me/active")},updateAvatar:function(e){return a("POST","/avatars",e)},deterministicUrl:function(e){return"".concat(r,"/").concat(e)}}},413:function(e,t,n){"use strict";n.d(t,"b",(function(){return m})),n.d(t,"a",(function(){return c}));var s=n(398),o=n(5),i=n.n(o),r=n(0),a=n(11),c=function(e){var t=i()(i.a.create('<div class="is-updating"></div>')),n=i()(i.a.create('<img class="user-avatar__image" alt="" />')),o=e.dataset.userid,a=r.a.get("user.id",null),c=function(t,n){t.remove(),n.appendTo(e)};e.classList.remove("is-hidden"),t.css("display","block").appendTo(e),o===a?s.a.getActive().then((function(e){n.attr("src",e.data.avatarUrl)})).catch((function(){var e=s.a.deterministicUrl(o);n.attr("src",e)})).always((function(){c(t,n)})):(n.attr("src",s.a.deterministicUrl(o)),c(t,n))},m=function(){return a.a.measure((function(){return document.getElementsByClassName("user-avatar")})).then((function(e){e&&Array.from(e).forEach(c)}))}},414:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var s=n(11),o=n(8),i=n(16),r=function(){s.a.measure((function(){return document.getElementsByClassName("js-id-send-validation-email")})).then((function(e){if(e.length){var t=e[0];t.addEventListener("click",(function(e){e.preventDefault(),Object(i.k)()&&Object(i.m)().then((function(e){if("error"===e.status)o.a.emit("module:identity:validation-email:fail"),s.a.mutate((function(){t.innerHTML="An error occured, please click here to try again."}));else{o.a.emit("module:identity:validation-email:success");var n=t.parentNode;if(n){var i=document.createElement("p");i.innerText="Sent. Please check your email and follow the link.",s.a.mutate((function(){n.replaceChild(i,t)}))}}}),(function(){o.a.emit("module:identity:validation-email:fail"),s.a.mutate((function(){t.innerHTML="An error occured, please click here to try again."}))}))}))}}))}},415:function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var s=n(21),o=n.n(s),i=n(27),r=n.n(i),a=n(78),c=n.n(a),m=n(79),u=n.n(m),l=n(47),d=n.n(l),h=n(15),p=n.n(h),f=n(0),v=n(8),g=n(384);var b=function(e){c()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=d()(e);if(t){var o=d()(this).constructor;n=Reflect.construct(s,arguments,o)}else n=s.apply(this,arguments);return u()(this,n)}}(n);function n(e){var s;return o()(this,n),s=t.call(this),Object(g.a)("series-content"),s.endpoint="/series/".concat([].concat(p()(f.a.get("page.nonKeywordTagIds","").split(",")),p()(f.a.get("page.blogIds","").split(",")),[f.a.get("page.seriesId")]).shift(),".json?shortUrl=").concat(encodeURIComponent(f.a.get("page.shortUrl"))),s.fetch(e,"html"),s}return r()(n,[{key:"error",value:function(){Object(g.c)("series-content")}},{key:"ready",value:function(){Object(g.b)("series-content"),v.a.emit("modules:onward:loaded")}}]),n}(n(58).a)},420:function(e,t,n){"use strict";n.d(t,"a",(function(){return le}));var s=n(21),o=n.n(s),i=n(27),r=n.n(i),a=n(64),c=n.n(a),m=n(78),u=n.n(m),l=n(79),d=n.n(l),h=n(47),p=n.n(h),f=n(2),v=n.n(f),g=n(20),b=n.n(g),y=n(5),C=n.n(y),w=n(32),k=n.n(w),O=n(12),j=n(29),E=n(0),S=n(13),T=n(8),_=n(222),A=n(11),P=n(6),D=n(40),R=n.n(D),I=!1,L=function(){I||(I=!0)},x=function(){I||(I=!0)},M=function(){I||T.a.on("window:throttledScroll",R()((function e(){var t,n,s;!I&&(t=Object(O.a)("#comments").offset(),n=window.pageYOffset,s=C.a.viewport().height,t.top-s/2<n&&t.top+t.height-s/3>n)&&(I||(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=E.a.get("googleAnalytics.trackers.editorial");window.ga("".concat(n,".send"),"event","element view","onpage item",e,Object.assign({nonInteraction:!0},t))}("scroll to comments"),I=!0),T.a.off("window:throttledScroll",R()(e,200)))}),200))},H=n(384),N=n(58),U=n(386),F=n(31),B=n.n(F),z=n(55),q=n.n(z),Y=n(16),V=n(413),J=n(414);var G=function(e){u()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=p()(e);if(t){var o=p()(this).constructor;n=Reflect.construct(s,arguments,o)}else n=s.apply(this,arguments);return d()(this,n)}}(n);function n(e){var s;return o()(this,n),s=t.call(this),v()(c()(s),"errors",void 0),v()(c()(s),"errorMessages",void 0),s.useBem=!0,s.templateName="comment-box",s.componentClass="d-comment-box",s.classes={},s.errors=[],s.defaultOptions={discussionId:null,apiRoot:null,maxLength:5e3,premod:!1,newCommenter:!1,hasUsername:!0,focus:!1,state:"top-level",replyTo:null,priorToVerificationDate:new Date(1392719401337)},s.errorMessages={EMPTY_COMMENT_BODY:"Please write a comment.",COMMENT_TOO_LONG:"Your comment must be fewer than 5000 characters long.",USER_BANNED:'Commenting has been disabled for this account (<a href="/community-faqs#321a">why?</a>).',IP_THROTTLED:'Commenting has been temporarily blocked for this IP address (<a href="/community-faqs">why?</a>).',DISCUSSION_CLOSED:"Sorry your comment can not be published as the discussion is now closed for comments.",PARENT_COMMENT_MODERATED:"Sorry the comment can not be published as the comment you replied to has been moderated since.",COMMENT_RATE_LIMIT_EXCEEDED:"You can only post one comment every minute. Please try again in a moment.",INVALID_PROTOCOL:"Sorry your comment can not be published as it was not sent over a secure channel. Please report us this issue using the technical issue link in the page footer.",AUTH_COOKIE_INVALID:"Sorry, your comment was not published as you are no longer signed in. Please sign in and try again.","READ-ONLY-MODE":"Sorry your comment can not currently be published as commenting is undergoing maintenance but will be back shortly. Please try again in a moment.",USERNAME_MISSING:'You must <a href="'.concat(E.a.get("page.mmaUrl"),'/public-settings">set a username</a> before commenting. (<a href="/help/2020/feb/10/why-am-i-unable-to-post-a-comment">Learn more</a>).'),API_CORS_BLOCKED:"Could not post due to your internet settings, which might be\n                 controlled by your provider. Please contact your administrator\n                 or disable any proxy servers or VPNs and try again.",API_ERROR:"Sorry, there was a problem posting your comment. Please try\n                another browser or network connection.  Reference code ",EMAIL_VERIFIED:'<span class="d-comment-box__error-meta">Sent. Please check your\n                email to verify your email address. Once verified post your\n                comment.</span>',EMAIL_VERIFIED_FAIL:'We are having technical difficulties. Please try again later or\n                <a href="/send/email" class="js-id-send-validation-email">\n                <strong>resend the verification</strong></a>.',EMAIL_NOT_VALIDATED:'Please confirm your email address to comment.<br />\n                If you can\'t find the email, we can\n                <a href="_#" class="js-id-send-validation-email">\n                <strong>resend the verification email</strong></a> to your email\n                address.'},s.setOptions(e),T.a.on("module:identity:validation-email:success",(function(){return s.verificationEmailSuccess()})),T.a.on("module:identity:validation-email:fail",(function(){return s.verificationEmailFail()})),s}return r()(n,null,[{key:"refreshUsernameHtml",value:function(){var e=q()(B.a.mark((function e(){var t,n,s,o,i;return B.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Object(Y.l)(),e.next=3,Object(U.a)();case 3:if((t=e.sent)&&t.userProfile){e.next=6;break}return e.abrupt("return");case 6:n=t.userProfile,s=n.displayName,o=document.querySelector(".js-profile-info"),i=document.querySelector("._author_tywwu_16"),o&&s&&(o.innerHTML=s),i&&s&&(i.innerHTML=s);case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}]),r()(n,[{key:"onboardingPreviewSuccess",value:function(e,t){var n=this.getElem("onboarding-preview-body");n&&(n.innerHTML=t.commentBody)}},{key:"getDiscussionId",value:function(){var e=this.options.discussionId,t=this.elem&&this.elem instanceof HTMLElement&&this.elem.getAttribute("data-discussion-key");return!e&&t&&(t=t.replace("discussion","")),e||t||""}},{key:"setFormState",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.getElem("body"),n=this.getElem("submit");n&&(e||0===t.value.length)?n.setAttribute("disabled","disabled"):n&&n.removeAttribute("disabled")}},{key:"setExpanded",value:function(){this.setState("expanded")}},{key:"getUserData",value:function(){return Object(Y.h)()}},{key:"clearErrors",value:function(){var e=this.getElem("messages");e&&(e.innerHTML=""),this.errors=[],this.removeState("invalid")}},{key:"previewCommentSuccess",value:function(e,t){var n=this.getElem("preview-body");n&&(n.innerHTML=t.commentBody),this.setState("preview-visible")}},{key:"fail",value:function(e){var t;try{t=JSON.parse(e.responseText)}catch(e){t={}}this.setFormState(),0===e.status?this.error("API_CORS_BLOCKED"):"EMAIL_NOT_VALIDATED"===t.errorCode?this.invalidEmailError():"IP_ADDRESS_BLOCKED"===t.errorCode?this.error("IP_THROTTLED"):this.errorMessages[t.errorCode]?this.error(t.errorCode):this.error("API_ERROR",this.errorMessages.API_ERROR+e.status)}},{key:"postCommentSuccess",value:function(e,t){n.refreshUsernameHtml(),this.options.newCommenter&&(this.options.newCommenter=!1);var s=this.getElem("body");return e.id=parseInt(t.message,10),s.value="",this.resetPreviewComment(),this.setFormState(),this.emit("post:success",e),T.a.emit("discussion:commentbox:post:success",e),e}},{key:"error",value:function(e,t){var n=this.getElem("messages");this.setState("invalid");var s='\n            <div class="d-discussion__error '.concat(this.getClass("error",!0),'">\n                <i class="i i-alert"></i>\n                <span class="d-discussion__error-text">\n                    ').concat(t||this.errorMessages[e],"\n                </span>\n            </div>");n&&n.appendChild(C.a.create(s)[0]),this.errors.push(e)}},{key:"postComment",value:function(){var e=this,t=this.getElem("body"),n={body:(t&&t instanceof HTMLTextAreaElement&&t||{}).value};this.clearErrors();var s=function(){var t,s;return e.removeState("onboarding-visible"),n.body=(t=n.body,s=new RegExp("\\b((https?://|www.)\\S+)\\b(?![^<]*>|[^<>]*</)","g"),t.replace(s,(function(e,t,n){var s="www."===n?"http://".concat(t):t;return'<a href="'.concat(s,'">').concat(t,"</a>")}))),e.setFormState(!0),Object(U.c)(e.getDiscussionId(),n).then((function(t){return e.postCommentSuccess(n,t)})).catch((function(t){return e.fail(t)}))},o=function(t){var n=e.getElem("onboarding-username");T.a.emit("user:username:updated",t.user.publicFields.username),e.options.hasUsername=!0,n&&n.classList.add("is-hidden"),s()},i=function(t){var n=e.getElem("onboarding-username-input"),s=e.getElem("onboarding-username-error-message");e.setState("onboarding-visible"),n&&n.classList.add("d-comment-box__onboarding-username-error-border"),s&&(s.innerHTML=JSON.parse(t.responseText).errors[0].description,s.classList.remove("is-hidden"))},r=function(){if(""===n.body&&e.error("EMPTY_COMMENT_BODY"),n.body.length>e.options.maxLength&&e.error("COMMENT_TOO_LONG","<b>Comments must be shorter than ".concat(e.options.maxLength," characters.</b>")+"Yours is currently ".concat(n.body.length-e.options.maxLength," character(s) too long.")),e.options.replyTo&&(n.replyTo=e.options.replyTo),0===e.errors.length){if(e.options.newCommenter&&!e.options.hasUsername){var t=e.getElem("onboarding-username-input");return Object(Y.p)(t.value).then(o,i)}return s()}return Promise.resolve()};return this.getUserData().emailVerified?r():new Date(this.getUserData().accountCreatedDate)>this.options.priorToVerificationDate?Object(Y.g)().then((function(t){if(!0===t.user.statusFields.userEmailValidated)return r();e.invalidEmailError()})):r()}},{key:"invalidEmailError",value:function(){this.removeState("onboarding-visible"),this.error("EMAIL_NOT_VALIDATED"),Object(J.a)()}},{key:"submitPostComment",value:function(e){e.preventDefault(),this.postComment()}},{key:"ready",value:function(){var e=this;if(null===this.getDiscussionId())throw new Error('CommentBox: You need to set the "data-discussion-key" on your element');var t=this.getElem("body");if(this.setFormState(),this.options.newCommenter?(b.a.on(document.body,"submit",[this.elem],(function(t){return e.showOnboarding(t)})),b.a.on(document.body,"click",this.getClass("onboarding-cancel"),(function(t){return e.hideOnboarding(t)}))):b.a.on(document.body,"submit",[this.elem],(function(t){return e.submitPostComment(t)})),b.a.on(document.body,"change keyup",[t],(function(){return e.setFormState()})),b.a.on(t,"focus",(function(){return e.setExpanded()})),this.on("change",".d-comment-box__body",(function(){return e.resetPreviewComment()})),this.on("click",this.getClass("preview"),(function(){return e.previewComment("previewCommentSuccess")})),this.on("click",this.getClass("hide-preview"),(function(){return e.resetPreviewComment()})),this.on("click",this.getClass("cancel"),(function(){return e.cancelComment()})),this.on("click",this.getClass("show-parent"),(function(){return e.setState("parent-visible")})),this.on("click",this.getClass("hide-parent"),(function(){return e.removeState("parent-visible")})),["bold","italic","quote","link"].forEach((function(t){var n=e.getClass("formatting-".concat(t));e.on("click",n,(function(){return e.formatComment(t)}))})),this.options.state&&this.setState(this.options.state),this.options.focus){var n=this.getElem("body");n&&window.setTimeout((function(){n.focus()}),0)}}},{key:"hideOnboarding",value:function(e){e.preventDefault(),this.removeState("onboarding-visible")}},{key:"showOnboarding",value:function(e){if(e.preventDefault(),this.hasState("onboarding-visible")||!this.options.newCommenter)this.options.hasUsername&&this.removeState("onboarding-visible"),this.postComment();else{var t=this.getElem("onboarding-author"),n=this.getElem("onboarding-username");t&&(t.innerHTML=this.getUserData().displayName),this.setState("onboarding-visible"),this.previewComment("onboardingPreviewSuccess"),n&&this.options.hasUsername&&n.classList.add("is-hidden")}}},{key:"prerender",value:function(){var e=this;if(!this.options.premod){var t=this.getElem("premod");t&&t.parentNode&&t.parentNode.removeChild(t)}var n=this.getUserData();if("response"===this.options.state){var s=this.getElem("submit");s&&(s.innerHTML="Post reply")}else if(this.options.shouldRenderMainAvatar){var o=this.getElem("avatar-wrapper");o&&(o.setAttribute("userid",n.id),o.setAttribute("data-userid",n.id),Object(V.a)(o))}else{var i=document.getElementsByClassName("d-comment-box__meta")[0];i&&i.parentNode&&i.parentNode.removeChild(i)}if(this.options.replyTo){var r=this.getElem("reply-to-author"),a=this.getElem("parent-comment-body"),c=this.getElem("parent-comment-author"),m=this.options.replyTo||{},u=m.author,l=m.timestamp,d=m.body;r&&u&&(r.innerHTML=u),c&&u&&l&&(c.innerHTML="".concat(u," @ ").concat(l," said:")),a&&d&&(a.innerHTML=d),window.setTimeout((function(){return t=e.getElem("parent-comment-spout"),n=!!r&&r.offsetLeft+r.getBoundingClientRect().width/2,void(t&&n&&(t.style.marginLeft="".concat(n,"px")));var t,n}),0)}}},{key:"verificationEmailSuccess",value:function(){this.clearErrors(),this.error("EMAIL_VERIFIED")}},{key:"verificationEmailFail",value:function(){this.clearErrors(),this.error("EMAIL_VERIFIED_FAIL")}},{key:"previewComment",value:function(e){var t=this,n={body:this.getElem("body").value},s=this[e].bind(this);if(this.clearErrors(),""===n.body&&(this.resetPreviewComment(),this.error("EMPTY_COMMENT_BODY")),n&&n.body&&n.body.length>this.options.maxLength){var o=n.body.length-this.options.maxLength,i="\n                <b>Comments must be shorter than\n                ".concat(this.options.maxLength," characters</b>. Yours is currently\n                ").concat(o," characters too long.");this.error("COMMENT_TOO_LONG",i)}0===this.errors.length&&Object(U.d)(n).then((function(e){return s(n,e)})).catch((function(e){return t.fail(e)}))}},{key:"cancelComment",value:function(){if("response"===this.options.state)this.destroy();else{var e=this.getElem("body");this.resetPreviewComment(),e.value="",this.setFormState(),this.removeState("expanded")}}},{key:"resetPreviewComment",value:function(){var e=this.getElem("preview-body");this.removeState("preview-visible"),e&&(e.innerHTML="")}},{key:"formatComment",value:function(e){var t=this.getElem("body"),n=t.selectionStart,s=t.value.substring(t.selectionStart,t.selectionEnd),o=function(e,o){var i=e+s+o;t.value=t.value.substring(0,t.selectionStart)+i+t.value.substring(t.selectionEnd),function(e){t.setSelectionRange(n,n+e.length)}(i)};switch(e){case"bold":o("<b>","</b>");break;case"italic":o("<i>","</i>");break;case"quote":o("<blockquote>","</blockquote>");break;case"link":!function(){var e,n;/^https?:\/\//i.test(s)?e=s:(e=n=window.prompt("Your URL:","http://www."),s=s||n);var o='<a href="'.concat(e,'">').concat(s,"</a>");t.value=t.value.substring(0,t.selectionStart)+o+t.value.substring(t.selectionEnd)}()}}}]),n}(N.a),K=n(49),$=n.n(K),W=n(9),X=n(14),Q=n(445),Z=n.n(Q),ee=function(){function e(t){o()(this,e),v()(this,"commentsThread",void 0),v()(this,"discussion",void 0),v()(this,"discussionContainer",void 0),v()(this,"discussionId",void 0),v()(this,"lastPage",void 0),v()(this,"params",void 0),v()(this,"postedCommentHtml",void 0),this.discussionId=t.discussionId,this.discussion=[],this.params={orderBy:t.orderBy,displayThreaded:t.displayThreaded,maxResponses:t.maxResponses,commentsClosed:t.commentsClosed}}return r()(e,[{key:"firstPageLoaded",value:function(e){if(this.storeCommentPage(e,1),this.discussionContainer=C.a.create(e.commentsHtml),this.postedCommentHtml=e.postedCommentHtml,this.lastPage=e.lastPage,this.commentsThread=Object(O.a)(".d-thread--comments",this.discussionContainer).empty(),e.commentCount>1e3)throw new Error("Discussion comment count too large");return Z()(2,this.lastPage+1)}},{key:"storeCommentPage",value:function(e,t){var n=Object(O.a)(".d-thread--comments",C.a.create(e.commentsHtml)),s=Object(O.a)(".d-comment--top-level",n);"newest"===this.params.orderBy&&(s=s.map((function(e){return e})).reverse()),this.discussion[t]=s}},{key:"loadPage",value:function(e){var t={orderBy:"oldest",page:e,pageSize:50,displayThreaded:this.params.displayThreaded,commentsClosed:this.params.commentsClosed};this.params.maxResponses&&(t.maxResponses=this.params.maxResponses);var n="/discussion/".concat(this.discussionId,".json?").concat(Object(X.b)(t));return Object(P.a)(n,{mode:"cors"})}},{key:"loadPageAndStore",value:function(e){var t=this;return this.loadPage(e).then((function(n){t.storeCommentPage(n,e)}))}},{key:"loadRemainingPages",value:function(e){return t=this.loadPageAndStore.bind(this),n=e,new Promise((function(e){var s=n,o=0,i=function(){o-=1,s.length?r(s.shift()):o||e()},r=function(e){o+=1,t.call(null,e).then(i,i)};n&&n.length?n.splice(0,3).forEach(r):e()}));var t,n}},{key:"makeDiscussionResponseObject",value:function(){return"newest"===this.params.orderBy&&this.discussion.reverse(),this.discussion.reduce((function(e,t){return e.append(t),e}),this.commentsThread),{paginationHtml:"",postedCommentHtml:this.postedCommentHtml,commentsHtml:this.discussionContainer.html(),lastPage:this.lastPage}}},{key:"loadAllComments",value:function(){var e=this;return this.loadPage(1).then((function(t){return e.firstPageLoaded(t)})).then((function(t){return e.loadRemainingPages(t)})).then((function(){return e.makeDiscussionResponseObject()}))}}]),e}(),te=n(385),ne=n(48),se=n(208);var oe=function(){return null===ne.a.get("discussion.enableRelativeTimestamps")||ne.a.get("discussion.enableRelativeTimestamps")},ie=function(e){u()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=p()(e);if(t){var o=p()(this).constructor;n=Reflect.construct(s,arguments,o)}else n=s.apply(this,arguments);return d()(this,n)}}(n);function n(e){var s;return o()(this,n),s=t.call(this),v()(c()(s),"comments",void 0),v()(c()(s),"topLevelComments",void 0),v()(c()(s),"user",void 0),v()(c()(s),"postedCommentEl",void 0),v()(c()(s),"wholeDiscussionErrors",void 0),s.componentClass="d-comments",s.comments=null,s.topLevelComments=null,s.user=null,s.classes={comments:"d-thread--top-level",topLevelComment:"d-comment--top-level",reply:"d-comment--response",showReplies:"d-show-more-replies",showRepliesButton:"d-show-more-replies__button",newComments:"js-new-comments",comment:"d-comment",commentReply:"d-comment__action--reply",commentPick:"d-comment__action--pick",commentStaff:"d-comment--staff",commentBody:"d-comment__body",commentTimestampJs:"js-timestamp",commentReport:"js-report-comment"},s.defaultOptions={discussionId:null,showRepliesCount:3,commentId:null,order:"newest",threading:"collapsed"},s.setOptions(e),s}return r()(n,[{key:"getMoreReplies",value:function(e){var t=this;e.preventDefault();var n=e.target,s=e.currentTarget,o=s.closest(this.getClass("showReplies"));o&&(o.innerHTML="Loadingâ€¦");var i=C()(n).data("source-comment"),r=s.getAttribute("data-comment-id");if(r){var a="/discussion/comment/".concat(r,".json?displayThreaded=true");Object(P.a)(a,{mode:"cors"}).then((function(e){var n=C.a.create(e.html),s=k()(t.getClass("reply"),n).slice(t.options&&t.options.showRepliesCount);C()(k()(".d-thread--responses",i)).append(s),C()(o).addClass("u-h"),t.emit("untruncate-thread"),oe()&&t.relativeDates()})).catch((function(e){Object(W.a)(e,{feature:"comments-more-replies"})}))}}},{key:"addMoreRepliesButtons",value:function(e){var t=this;(e||this.topLevelComments).forEach((function(e){var n=parseInt(e.getAttribute("data-comment-replies"),10),s=k()(t.getClass("reply"),e);if(s.length<n){var o=n-s.length,i=Object(se.a)("plus",["icon"]),r=1===o?"reply":"replies",a='\n                    <button class="u-button-reset button button--show-more button--small button--tone-news d-show-more-replies__button">\n                        '.concat(i,"Show ").concat(o," more ").concat(r,"\n                    </button>"),c=O.a.create(a).attr({"data-link-name":"Show more replies","data-is-ajax":"","data-comment-id":e.getAttribute("data-comment-id")}).data("source-comment",e);O.a.create('<li class="'.concat(t.getClass("showReplies",!0),'"></li>')).append(c).appendTo(Object(O.a)(".d-thread--responses",e))}}))}},{key:"fetchComments",value:function(){var e,t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=(this.options||{}).discussionId,o="/discussion/".concat(n.comment?"comment-context/".concat(n.comment):s,".json"),i=n.order||this.options&&this.options.order,r={mode:"cors"};"recommendations"===i&&(i="mostRecommended");var a={orderBy:i,pageSize:n.pagesize||this.options&&this.options.pagesize,displayThreaded:!(!this.options||"unthreaded"===this.options.threading),commentsClosed:n.commentsClosed};return n.page&&(a.page=n.page),!n.comment&&this.options&&"collapsed"===this.options.threading&&(a.maxResponses=3),this.isAllPageSizeActive()?e=new ee({discussionId:this.options&&this.options.discussionId,orderBy:a.orderBy,displayThreaded:a.displayThreaded,maxResponses:a.maxResponses,commentsClosed:a.commentsClosed}).loadAllComments().catch((function(){return t.wholeDiscussionErrors=!0,a.pageSize=100,Object(P.a)("".concat(o,"?").concat(Object(X.b)(a)),r)})):("All"===a.pageSize&&(a.pageSize=100),e=Object(P.a)("".concat(o,"?").concat(Object(X.b)(a)),r)),e.then((function(e){return t.renderComments(e)}))}},{key:"handlePickClick",value:function(e){e.preventDefault();var t=e.target,n=t.getAttribute("data-comment-id"),s=Object(O.a)(t),o="true"===s[0].getAttribute("data-comment-highlighted")?this.unPickComment:this.pickComment;n&&o.call(this,n,s).catch((function(e){var t=e.response.length>0?JSON.parse(e.response).message:e.statusText;s.text(t)}))}},{key:"pickComment",value:function(e,t){var n=this,s=k()("#comment-".concat(e),this.elem);return Object(U.b)(e).then((function(){Object(O.a)(n.getClass("commentPick"),s).removeClass("u-h"),t.text("Unpick"),s.setAttribute("data-comment-highlighted",!0)}))}},{key:"ready",value:function(){var e=this;this.topLevelComments=k()(this.getClass("topLevelComment"),this.elem),this.comments=k()(this.getClass("comment"),this.elem),this.on("click",this.getClass("showRepliesButton"),(function(t){return e.getMoreReplies(t)})),this.on("click",this.getClass("commentReport"),(function(t){return e.reportComment(t)})),oe()&&(window.setInterval((function(){return e.relativeDates()}),6e4),this.relativeDates()),this.emit("ready"),this.on("click",".js-report-comment-close",(function(){var e=document.querySelector(".js-report-comment-form");e&&e.setAttribute("hidden","")}))}},{key:"showHiddenComments",value:function(e){e&&e.preventDefault(),this.emit("first-load"),Object(O.a)(".js-discussion-main-comments").css("display","block"),oe()&&this.relativeDates()}},{key:"unPickComment",value:function(e,t){var n=this,s=k()("#comment-".concat(e));return Object(U.g)(e).then((function(){Object(O.a)(n.getClass("commentPick"),s).addClass("u-h"),t.text("Pick"),s.setAttribute("data-comment-highlighted",!1)}))}},{key:"isReadOnly",value:function(){return!!(this.elem&&this.elem instanceof HTMLElement&&"true"===this.elem.getAttribute("data-read-only"))}},{key:"addComment",value:function(e,t){var n=C.a.create(this.postedCommentEl)[0],s=C()(n),o=n&&n.getElementsByClassName(this.getClass("commentReply",!0))[0],i={username:"d-comment__author",timestamp:"js-timestamp",body:"d-comment__body",report:"d-comment__action--report",avatar:"d-comment__avatar"},r={username:this.user&&this.user.displayName,timestamp:"Just now",body:"<p>".concat(e.body.replace(/\n+/g,"</p><p>"),"</p>"),report:{href:"http://discussion.theguardian.com/components/report-abuse/".concat(e.id)},avatar:{src:this.user&&this.user.avatar}};s.addClass("d-comment--new"),Object.keys(i).forEach((function(e){var t=i[e],s=r[e],o=k()(".".concat(t),n)[0];"string"==typeof s?o.innerHTML=s:"object"===$()(s)&&Object.keys(s).forEach((function(e){o.setAttribute(e,s[e])}))})),n.id="comment-".concat(e.id),this.user&&!this.user.isStaff&&s.addClass(this.getClass("commentStaff",!0)),o&&o.setAttribute("data-comment-id",e.id),t?(s.removeClass(this.getClass("topLevelComment",!0)),s.addClass(this.getClass("reply",!0)),C()(t).append(s)):Object(O.a)(this.getClass("newComments"),this.elem).prepend(n),window.location.replace("#comment-".concat(e.id))}},{key:"replyToComment",value:function(e){var t=this;e.preventDefault();var n=e.currentTarget.getAttribute("data-comment-id");if(n){var s=document.getElementById("reply-to-".concat(n));if(s)s.focus();else{Object(O.a)(".d-comment-box--response").remove();var o=k()("#comment-".concat(n))[0],i=o.getAttribute("data-comment-author"),r=o.getAttribute("data-comment-author-id"),a=C()(o),c=k()(this.getClass("commentBody"),o)[0].innerHTML,m=k()(this.getClass("commentTimestampJs"),o)[0].innerHTML,u=new G({discussionId:this.options&&this.options.discussionId,premod:this.user&&this.user.privateFields&&this.user.privateFields.isPremoderated,state:"response",replyTo:{commentId:n,author:i,authorId:r,body:c,timestamp:m},focus:!0}),l=a.hasClass(this.getClass("topLevelComment",!0))?a[0]:a.parent().parent()[0],d=k()(this.getClass("showReplies"),l);d.length>0&&!C()(d).hasClass("u-h")&&d[0].click(),u.render(l),u.on("post:success",(function(e){var n=k()(".d-thread--responses",l)[0];n||(n=C.a.create('<ul class="d-thread d-thread--responses"></ul>')[0],C()(l).append(n)),u.destroy(),t.addComment(e,n)}))}}}},{key:"reportComment",value:function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-comment-id");if(t){var n=document.querySelector("#comment-".concat(t," .js-report-comment-container"));Object(O.a)(".js-report-comment-form").first().each((function(e){e.removeAttribute("hidden"),b.a.one(e,"submit",(function(n){n.preventDefault();var s=e.querySelector('[name="category"]'),o=e.querySelector('[name="comment"]');if(t&&"0"!==s.value){var i=e.querySelector('[name="email"]');Object(U.f)(t,{emailAddress:i.value,categoryId:s.value,reason:o.value}).then((function(){e.setAttribute("hidden","")})).catch((function(){return e=document.querySelector(".d-report-comment__close"),(t=document.querySelector(".js-discussion__report-comment-error"))&&t.removeAttribute("hidden"),void(e&&e.classList.add("d-report-comment__close--error"));var e,t}))}}))})).appendTo(n)}}},{key:"addUser",value:function(e){var t=this;this.user=e,this.user&&this.user.badge&&(this.user.isStaff=this.user.badge.some((function(e){return"Staff"===e.name}))),this.isReadOnly()||this.user&&this.user.privateFields.canPostComment&&(Object(O.a)(this.getClass("commentReply")).attr("href","#"),this.on("click",this.getClass("commentReply"),(function(e){return t.replyToComment(e)})),this.on("click",this.getClass("commentPick"),(function(e){return t.handlePickClick(e)}))),T.a.on("user:username:updated",(function(e){t.user&&(t.user.displayName=e)}))}},{key:"relativeDates",value:function(){oe()&&Object(te.a)()}},{key:"isAllPageSizeActive",value:function(){return!(!E.a.get("switches.discussionAllPageSize")||!this.options||"All"!==this.options.pagesize||this.wholeDiscussionErrors)}},{key:"shouldShowPageSizeMessage",value:function(){return!!(E.a.get("switches.discussionAllPageSize")&&this.options&&"All"===this.options.pagesize&&this.wholeDiscussionErrors)}},{key:"renderComments",value:function(e){var t=C.a.create(e.commentsHtml),n=k()(this.getClass("comment"),t);C()(this.elem).empty().append(t),this.addMoreRepliesButtons(n),this.postedCommentEl=e.postedCommentHtml,oe()&&this.relativeDates(),this.emit("rendered",e.paginationHtml),T.a.emit("modules:comments:renderComments:rendered")}}]),n}(N.a),re=n(17),ae=n.n(re),ce=n(396),me=n(377),ue=function(e,t,n){var s,o=E.a.get("switches.discussionAllowAnonymousRecommendsSwitch");if(!o&&!n)return e.setAttribute("data-link-name","Recommend comment anonymous"),function(e){var t=document.querySelector(".".concat("js-rec-tooltip"));if(!t)return Promise.resolve();var n=t.querySelectorAll(".js-rec-tooltip-link");return A.a.mutate((function(){!function(e,t){for(var n=0,s=e.length;n<s;n+=1){var o=e[n].getAttribute("href");if(o){var i=o.split("?")[0],r=Object(X.d)(o.split("?")[1]||"&");e[n].setAttribute("href","".concat(i,"?").concat(Object(X.b)(Object.assign({},r,{returnUrl:t}))))}}}(n,e.getAttribute("data-comment-url")),t.removeAttribute("hidden"),e.appendChild(t)}))}(e);if((o||n)&&(s=t)&&s.querySelector(".d-discussion--recommendations-open")){var i=e.getAttribute("data-comment-id");return i?Promise.all([function(e){return A.a.mutate((function(){e.classList.remove("js-recommend-comment"),e.classList.add("d-comment__recommend--clicked")}))}(e),Object(U.e)(i)]).then((function(){return function(e){return A.a.mutate((function(){e.classList.add("d-comment__recommend--recommended")}))}(e)})).catch((function(t){return function(e){return A.a.mutate((function(){e.classList.add("js-recommend-comment"),e.classList.remove("d-comment__recommend--clicked")}))}(e).then((function(){Object(W.a)(t,{feature:"comments-recommend"})}))})):Promise.resolve()}return Promise.resolve()};var le=function(e){u()(n,e);var t=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=p()(e);if(t){var o=p()(this).constructor;n=Reflect.construct(s,arguments,o)}else n=s.apply(this,arguments);return d()(this,n)}}(n);function n(){var e;return o()(this,n),e=t.call(this),v()(c()(e),"$topCommentsContainer",void 0),v()(c()(e),"comments",void 0),v()(c()(e),"topCommentCount",void 0),v()(c()(e),"user",void 0),v()(c()(e),"username",void 0),e.classes={},e.componentClass="discussion",e.comments=null,e.user=null,e.username=null,Object(H.a)("discussion"),e}return r()(n,[{key:"getUser",value:function(){var e=this;Object(Y.h)()?Object(U.a)().then((function(t){e.user=t.userProfile,Object(Y.f)((function(t){t&&t.publicFields.username&&(e.username=t.publicFields.username),e.emit("user:loaded")}))})):this.emit("user:loaded")}},{key:"getDiscussionId",value:function(){if(this.elem&&this.elem instanceof HTMLElement)return this.elem.getAttribute("data-discussion-key")}},{key:"getDiscussionClosed",value:function(){return!!(this.elem&&this.elem instanceof HTMLElement&&"true"===this.elem.getAttribute("data-discussion-closed"))}},{key:"getCommentIdFromHash",value:function(){var e=/#comment-(\d+)/.exec(window.location.hash);return e?parseInt(e[1],10):null}},{key:"setCommentHash",value:function(e){window.location.replace("#comment-".concat(e))}},{key:"commentPosted",value:function(e){this.removeState("truncated"),this.comments&&this.comments.addComment(e)}},{key:"initState",value:function(){this.getDiscussionClosed()?this.setState("closed"):this.comments&&this.comments.isReadOnly()?this.setState("readonly"):Object(Y.h)()&&this.user&&this.user.privateFields&&!this.user.privateFields.canPostComment?this.setState("banned"):this.setState("open")}},{key:"isCommentable",value:function(){var e=this.user&&this.user.privateFields&&this.user.privateFields.canPostComment,t=this.comments&&!this.comments.isReadOnly();return!(!e||!t||this.getDiscussionClosed())}},{key:"ready",value:function(){var e=this;this.$topCommentsContainer=Object(O.a)(".js-discussion-top-comments"),this.initTopComments(),this.initMainComments(),this.initToolbar(),this.renderCommentCount(),this.initPagination(),this.initRecommend(),T.a.on("discussion:seen:comment-permalink",x),T.a.on("discussion:seen:comments-anchor",L),M(),"#comments"===window.location.hash?T.a.emit("discussion:seen:comments-anchor"):this.getCommentIdFromHash()&&T.a.emit("discussion:seen:comment-permalink"),T.a.on("discussion:commentbox:post:success",(function(){return e.removeState("empty")})),T.a.on("module:clickstream:click",(function(t){t&&"hash"in t.target&&"#comments"===t.target.hash&&e.removeTruncation()})),Object(H.b)("discussion")}},{key:"initRecommend",value:function(){var e=this;this.on("click",".js-recommend-comment",(function(t){var n=t.currentTarget;e.user&&e.elem instanceof HTMLElement&&ue(n,e.elem,e.user)})),this.on("click",".js-rec-tooltip-close",(function(){A.a.mutate((function(){var e=document.querySelector(".".concat("js-rec-tooltip"));e&&e.setAttribute("hidden","")}))}))}},{key:"initToolbar",value:function(){var e=this,t=Object(O.a)(".js-comment-order"),n=Object(O.a)(".js-comment-threading");if(n.text(this.comments&&this.comments.options.threading),t.text(this.comments&&this.comments.options.order),this.on("click",".js-comment-order-dropdown .popup__action",(function(n){b.a.fire(k()(".js-comment-order-dropdown [data-toggle]")[0],"click"),e.comments&&(e.comments.options.order=C()(n.currentTarget).data("order")),t.text(e.comments&&e.comments.options.order),ne.a.set("discussion.order",e.comments&&e.comments.options.order),e.loadComments({page:1})})),this.on("click",".js-comment-threading-dropdown .popup__action",(function(t){b.a.fire(k()(".js-comment-threading-dropdown [data-toggle]")[0],"click"),e.comments&&(e.comments.options.threading=C()(t.currentTarget).data("threading")),n.text(e.comments&&e.comments.options.threading),ne.a.set("discussion.threading",e.comments&&e.comments.options.threading),e.loadComments()})),"crosswords"===E.a.get("page.section")){var s=Object(O.a)(".js-timestamps"),o=function(e){s.text(e?"Relative":"Absolute")};o();var i=null===ne.a.get("discussion.enableRelativeTimestamps")||ne.a.get("discussion.enableRelativeTimestamps");o(i),this.on("click",".js-timestamps-dropdown .popup__action",(function(t){var n=C()(t.currentTarget).data("timestamp");b.a.fire(k()(".js-timestamps-dropdown [data-toggle]")[0],"click"),o("relative"===n),ne.a.set("discussion.enableRelativeTimestamps","relative"===n),e.loadComments()}))}}},{key:"initPageSizeDropdown",value:function(e){var t=this,n=Object(O.a)(".js-comment-pagesize");n.text(e),this.on("click",".js-comment-pagesize-dropdown .popup__action",(function(e){var s=C()(e.currentTarget).data("pagesize");b.a.fire(k()(".js-comment-pagesize-dropdown [data-toggle]")[0],"click"),t.comments&&(t.comments.options.pagesize=s),n.text(s),ne.a.set("discussion.pagesize",s),t.loadComments({page:1})}))}},{key:"initMainComments",value:function(){var e=this,t=this.getCommentIdFromHash(),n=ne.a.get("discussion.order")||(this.getDiscussionClosed()?"oldest":"newest"),s=ne.a.get("discussion.threading")||"collapsed",o=Object(S.m)({min:"tablet"})?25:10;this.comments=new ie({discussionId:this.getDiscussionId(),order:n,pagesize:o,threading:s}),this.comments&&this.comments.attachTo(k()(".js-discussion-main-comments")[0]),this.comments&&this.comments.on("untruncate-thread",(function(){return e.removeTruncation()})),this.on("click,",".js-discussion-author-link",(function(){return e.removeTruncation()})),this.on("click",".js-discussion-change-page, .js-discussion-show-button",(function(){T.a.emit("discussion:comments:get-more-replies"),e.removeTruncation()})),this.comments&&this.comments.on("rendered",(function(t){var n=C.a.create(t),s=k()(".js-discussion-toolbar",e.elem)[0],o=Object(O.a)(".js-discussion-pagination",s).empty();e.comments&&!e.comments.isAllPageSizeActive()&&o.html(n)})),this.setState("loading"),this.on("user:loaded",(function(){if(e.initState(),e.renderCommentBar(),e.user){e.comments&&e.comments.addUser(e.user);var n=ne.a.get("discussion.pagesize"),s=o;"number"==typeof n?s=n:"All"===n&&(s=E.a.get("switches.discussionAllPageSize")?"All":100),e.initPageSizeDropdown(s),e.comments&&E.a.get("switches.discussionPageSize")&&Object(S.m)({min:"tablet"})&&(e.comments.options.pagesize=s),e.user&&e.user.isStaff&&(e.removeState("not-staff"),e.setState("is-staff"))}var i=!t&&"#comments"!==window.location.hash;e.loadComments({comment:t,shouldTruncate:i}).catch((function(){return e.logError("Comments")}))})),this.getUser()}},{key:"initTopComments",value:function(){var e=this,t=this.getDiscussionId();return this.on("click",".js-jump-to-comment",(function(t){t.preventDefault();var n=C()(t.currentTarget).data("comment-id");e.gotoComment(n)})),t?Object(P.a)("/discussion/top-comments/".concat(t,".json?commentsClosed=").concat(this.getDiscussionClosed().toString()),{mode:"cors"}).then((function(t){e.$topCommentsContainer.html(t.html),e.topCommentCount=k()(".d-top-comment",e.$topCommentsContainer[0]).length,0!==e.topCommentCount&&(Object(O.a)(".js-discussion-comment-box--bottom").removeClass("discussion__comment-box--bottom--hidden"),e.setState("has-top-comments"))})).catch((function(){return e.logError("Top comments")})):Promise.resolve()}},{key:"logError",value:function(e,t){var n="".concat(e," failed to load: ");t&&t.message&&(n+=t.message),j.a.captureMessage(n,{tags:{contentType:"comments",discussionId:this.getDiscussionId()}})}},{key:"initPagination",value:function(){var e=this;this.on("click",".js-discussion-change-page",(function(t){var n=t.currentTarget,s=parseInt(n.getAttribute("data-page"),10);t.preventDefault(),e.setState("loading"),e.gotoPage(s)}))}},{key:"gotoComment",value:function(e,t){var n=this;Object(O.a)("#comment-".concat(e),this.elem).length>0?"none"===Object(O.a)(".js-discussion-main-comments").css("display")?A.a.mutate((function(){n.comments&&n.comments.showHiddenComments(),n.removeState("truncated"),Object(O.a)(".d-discussion__show-all-comments").addClass("u-h")})).then((function(){n.setCommentHash(e)})):this.setCommentHash(e):t?(Object(_.b)(k()(".js-discussion-toolbar"),100),A.a.mutate((function(){Object(O.a)(".js-discussion-main-comments").prepend('<div class="d-discussion__message d-discussion__message--error">The comment you requested could not be found.</div>')})),j.a.captureMessage("Comment doesn't exist in response",{level:"error",extra:{commentId:e}})):this.loadComments({comment:e})}},{key:"gotoPage",value:function(e){Object(_.b)(k()(".js-discussion-toolbar"),100),this.comments&&this.comments.relativeDates(),this.loadComments({page:e})}},{key:"loadComments",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=Object.assign({},t);return this.setState("loading"),n.shouldTruncate&&this.comments&&this.comments.isAllPageSizeActive()&&(n.pageSize=10),n.commentsClosed=this.getDiscussionClosed(),this.comments?this.comments.fetchComments(n).then((function(){e.removeState("loading"),n.shouldTruncate?e.setState("truncated"):e.removeState("truncated"),e.comments&&e.comments.shouldShowPageSizeMessage()?e.setState("pagesize-msg-show"):e.removeState("pagesize-msg-show"),n.comment&&e.gotoComment(n.comment.toString(),!0)})):Promise.resolve()}},{key:"removeTruncation",value:function(){this.comments&&this.comments.isAllPageSizeActive()?this.loadComments():this.removeState("truncated")}},{key:"renderCommentBox",value:function(e){var t=this;new G({discussionId:this.getDiscussionId(),premod:this.user&&this.user.privateFields&&this.user.privateFields.isPremoderated,newCommenter:this.user&&this.user.privateFields&&!this.user.privateFields.hasCommented,hasUsername:null!==this.username,shouldRenderMainAvatar:!1}).render(e).on("post:success",(function(e){return t.commentPosted(e)}))}},{key:"renderCommentBar",value:function(){this.isCommentable()&&(this.renderCommentBox(k()(".js-discussion-comment-box--top")[0]),this.renderCommentBox(k()(".js-discussion-comment-box--bottom")[0]))}},{key:"renderCommentCount",value:function(){!function(e,t){var n=function(t){t.on("error",(function(e,t){Object(W.a)(t,{feature:"discussion-".concat(e)},!1)})),t.once("comment-count",(function(t){0===t?e.setState("empty"):Array.from(document.getElementsByClassName("js_commentcount_actualvalue")).forEach((function(e){!function(e,t){var n=Object(ce.a)(t);n&&ae.a.mutate((function(){e.textContent=n}))}(e,t)})),T.a.emit("comments-count-loaded")}))},s=function(e){Object(W.a)(e,{feature:"discussion"})};Object(me.a)(E.a.get("page.discussionFrontendUrl")).then((function(){(0,window.guardian.app.discussion)(t).then(n).catch(s)})).catch(s)}(this,{apiHost:E.a.get("page.discussionApiUrl"),avatarImagesHost:E.a.get("page.avatarImagesUrl"),closed:this.getDiscussionClosed(),discussionId:this.getDiscussionId(),element:document.getElementsByClassName("js-discussion-external-frontend")[0],userFromCookie:!!Object(Y.h)(),profileUrl:E.a.get("page.idUrl"),profileClientId:E.a.get("switches.registerWithPhone")?"comments":"",Promise:Promise})}}]),n}(N.a)},445:function(e,t,n){var s=n(508)();e.exports=s},508:function(e,t,n){var s=n(509),o=n(218),i=n(289);e.exports=function(e){return function(t,n,r){return r&&"number"!=typeof r&&o(t,n,r)&&(n=r=void 0),t=i(t),void 0===n?(n=t,t=0):n=i(n),r=void 0===r?t<n?1:-1:i(r),s(t,n,r,e)}}},509:function(e,t){var n=Math.ceil,s=Math.max;e.exports=function(e,t,o,i){for(var r=-1,a=s(n((t-e)/(o||1)),0),c=Array(a);a--;)c[i?a:++r]=e,e+=o;return c}}}]);
//# sourceMappingURL=graun.article~crosswords~trail.js.map